<div class="container">
  <header class="header">
    <h1 class="title">Partyclick</h1>
  </header>
  
  <main class="main-content">
    <p class="description">
      Upload 4 crazy fun clicks that you take in the event
    </p>
    
    <div class="upload-boxes">
      <div class="upload-box" *ngFor="let box of uploadBoxes; let i = index" (click)="openCamera(i)">
        <!-- Show captured photo if available -->
        <div *ngIf="capturedPhotos[i]; else showPlusIcon" class="captured-photo">
          <img [src]="capturedPhotos[i]" alt="Captured photo" class="photo-preview">
          <button class="retake-btn" (click)="retakePhoto(i); $event.stopPropagation()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10M23 14L18.36 18.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        
        <!-- Show plus icon if no photo -->
        <ng-template #showPlusIcon>
          <div class="plus-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </ng-template>
      </div>
    </div>
    
    <!-- Upload Button -->
    <div class="upload-section">
      <button class="upload-btn" (click)="openConfirmModal()" [disabled]="!hasPhotos || isUploading">
        <span *ngIf="!isUploading">Upload {{ photoCount }} Photo{{ photoCount !== 1 ? 's' : '' }}</span>
        <span *ngIf="isUploading">Uploading...</span>
      </button>
    </div>
  </main>
</div>

<!-- Camera Modal -->
<div class="camera-modal" *ngIf="showCameraModal" (click)="closeCamera()">
  <div class="camera-container" (click)="$event.stopPropagation()">
    <div class="camera-header">
      <h3>Take Photo</h3>
      <button class="close-btn" (click)="closeCamera()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    
    <div class="camera-viewfinder">
      <video id="camera-video" autoplay muted playsinline></video>
      <canvas id="camera-canvas" style="display: none;"></canvas>
    </div>
    
    <div class="camera-controls">
      <button class="capture-btn" (click)="capturePhoto()">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="currentColor"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="confirm-modal" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="confirm-container" (click)="$event.stopPropagation()">
    <div class="confirm-header">
      <h3>Confirm Upload</h3>
    </div>
    
    <div class="confirm-content">
      <p>Would you like to submit all the photos you have taken?</p>
      <div class="photo-count">
        {{ photoCount }} photo{{ photoCount !== 1 ? 's' : '' }} ready to upload
      </div>
    </div>
    
    <div class="confirm-actions">
      <button class="cancel-btn" (click)="closeConfirmModal()">Cancel</button>
      <button class="confirm-btn" (click)="confirmUpload()">Yes, Upload</button>
    </div>
  </div>
</div>

<!-- Upload Progress Modal -->
<div class="progress-modal" *ngIf="isUploading">
  <div class="progress-container">
    <div class="progress-header">
      <h3>Uploading Photos</h3>
    </div>
    
    <div class="progress-content">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="uploadProgress"></div>
      </div>
      <p class="progress-text">{{ uploadProgress }}% Complete</p>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="success-modal" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
  <div class="success-container" (click)="$event.stopPropagation()">
    <div class="success-icon">
      <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    
    <div class="success-content">
      <h3>Upload Successful!</h3>
      <p>Your {{ photoCount }} photo{{ photoCount !== 1 ? 's' : '' }} have been uploaded successfully.</p>
    </div>
    
    <div class="success-actions">
      <button class="success-btn" (click)="closeSuccessModal()">Done</button>
    </div>
  </div>
</div>
